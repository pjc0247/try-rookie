<html>
    <head>
        <title>TryRookie</title>
        <style type="text/css" media="screen">
            #editor { 
                position: absolute;

                width: 600px;
                height: 480px;

                top: calc(50% - 240px);
                left: calc(50% - 300px);
            }
        </style>
    </head>
    <body>
<div id="editor">class rookie_program {
    def main() {
        print("Hello World!");
    }
}
</div>
    </body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/theme-xcode.js"></script>
<script>
    var prev_log = console.log;
    console.log = function(v) {
        prev_log("!" + v);
    };
</script>
<script src="rklang.js"></script>
<script>
    console.log = prev_log;
</script>>

<script>
var _wasm_str = function(str) {
    return allocate(intArrayFromString(str), 'i8', 0);
}
var _wasm_free = function(ptr) {
    _free(ptr);
}


var rkexec = function(src) {
    var ptr = _wasm_str(src);
    _rk_compile_and_run(ptr);
    _wasm_free(ptr);
}
</script>

<script>
var editor = ace.edit("editor");
editor.setTheme("ace/theme/xcode");
editor.session.setMode("ace/mode/ruby");
        
editor.on("input", function() {
    let prev_log = console.log;
    console.info = function(v) {
        prev_log("!" + v);
    };
    rkexec(editor.getValue());

    console.info = prev_log;
});
</script>